# ================================
# 初春图床系统 / OneImg
# Vue 3 + Go 图床管理系统
# ================================

# --- 基础信息 / Basic Information ---
local app_id="oneimg"                          # 必须与文件名一致
local app_name="OneImg"                   # 应用显示名称
local app_text="基于Vue3+Go的现代化图床系统，支持POW验证、剪贴板上传等高级功能"
local app_url="https://github.com/onexru/oneimg"
local docker_name="oneimg"                     # 容器名称（compose 中定义）
local docker_port="8080"                       # 默认访问端口
local app_size="1"                             # 约 1GB

# --- 核心逻辑 / Core Logic ---
docker_app_install() {

    echo "开始安装 初春图床系统 (OneImg)..."

    # 创建应用目录（必须在 /home/docker 下）
    mkdir -p /home/docker/oneimg && cd /home/docker/oneimg || exit 1

    # 下载 docker-compose.yml
    curl -L -o docker-compose.yml \
        "${gh_proxy}https://raw.githubusercontent.com/onexru/oneimg/main/docker-compose.yml"

    # 端口替换（支持用户自定义端口）
    sed -i "s/8080:8080/${docker_port}:8080/g" docker-compose.yml

    # 启动服务
    docker compose up -d

    echo "初春图床系统 安装完成"
    check_docker_app_ip
}

docker_app_update() {

    echo "更新 初春图床系统..."

    cd /home/docker/oneimg
    docker compose pull
    docker compose up -d

    echo "初春图床系统 更新完成"
}

docker_app_uninstall() {

    echo "卸载 初春图床系统..."

    cd /home/docker/oneimg

    # 停止并删除容器及镜像
    docker compose down --rmi all

    # 删除数据目录
    rm -rf /home/docker/oneimg

    echo "初春图床系统 已卸载"
}

# --- 注册 (必须包含) / Registration ---
docker_app_plus
