# --- 基础信息 / Basic Information ---
local app_id="frappe"
local app_name="ERPNext (Frappe)"
local app_text="企业级开源ERP解决方案，内置财务、仓库、人力资源等模块"
local app_url="https://frappeframework.com"
local docker_name="frappe-frontend"
local docker_port="8208"
local app_size="4" # ERPNext 镜像很大，且需要数据库，建议至少 4GB 空间

# --- 核心逻辑 / Core Logic ---
docker_app_install() {
    # 1. 环境准备
    local base_dir="/home/docker/frappe"
    mkdir -p "$base_dir" && cd "$base_dir"

    # 2. 获取官方 PWD (演示版) 配置文件
    # 这种配置方式最省心，已经预置了 MariaDB, Redis 和所有 Worker
    echo "正在下载官方演示部署配置..."
    curl -L ${gh_proxy}raw.githubusercontent.com/frappe/frappe_docker/main/pwd.yml -o docker-compose.yml
    
    # 3. 端口处理 (PWD 默认端口是 8080)
    sed -i "s/8080:8080/${docker_port}:8080/g" docker-compose.yml

    # 4. 启动容器
    echo "正在拉取镜像并启动 Frappe 栈 (这可能需要几分钟，镜像较多)..."
    docker compose up -d

    # 5. 等待初始化
    echo "------------------------------------------------"
    echo "正在初始化 ERPNext 站点，请耐心等待 2-5 分钟..."
    echo "你可以通过命令 'docker logs -f create-site' 查看进度。"
    echo ""
    echo "安装完成后访问地址: http://服务器IP:${docker_port}"
    echo "默认账号: Administrator"
    echo "默认密码: admin"
    echo "------------------------------------------------"

    check_docker_app_ip
}

docker_app_update() {
    cd /home/docker/frappe
    docker compose pull
    docker compose up -d
    echo "更新完成 / Update Complete"
}

docker_app_uninstall() {
    cd /home/docker/frappe
    # Frappe 的数据卷非常多，建议带上 -v 彻底清理
    docker compose down -v --rmi all
    rm -rf /home/docker/frappe
    echo "卸载完成 / Uninstall Complete"
}

# --- 注册 / Registration ---
docker_app_plus
